<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Virtual Furniture Placement - Markerless AR</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.min.js"></script>
</head>
<body style="margin: 0; padding: 0;">

    <!-- A-Frameシーン -->
    <a-scene embedded arjs="sourceType: webcam; detectionMode: mono_and_matrix; matrixCodeType: 3x3">
        <!-- 家具の3Dモデル。初期状態では非表示 -->
        <a-entity id="simplelowtable" gltf-model="url(/models/simplelowtable.glb)" scale="1 1 1" position="0 0 -5" visible="false" class="movable"></a-entity>

        <!-- カメラ -->
        <a-entity camera></a-entity>
    </a-scene>

    <!-- 家具を表示するボタン -->
    <button id="show-model-btn" style="position: absolute; top: 10px; left: 10px; z-index: 10;">
        Show Simple Low Table 1
    </button>

    <!-- 家具の表示を制御し、タッチ操作で移動させるスクリプト -->
    <script>
        // ボタンと3Dモデルの要素を取得
        let button = document.getElementById('show-model-btn');
        let furniture = document.getElementById('simplelowtable');

        // 家具を表示する
        button.addEventListener('click', function () {
            furniture.setAttribute('visible', true);
        });

        // タッチイベントのリスナーを追加して家具を移動
        let isDragging = false;
        let initialTouchPos = { x: 0, y: 0 };

        furniture.addEventListener('touchstart', function (event) {
            isDragging = true;
            let touch = event.touches[0];
            initialTouchPos = { x: touch.clientX, y: touch.clientY };
        });

        furniture.addEventListener('touchmove', function (event) {
            if (!isDragging) return;

            let touch = event.touches[0];
            let deltaX = touch.clientX - initialTouchPos.x;
            let deltaY = touch.clientY - initialTouchPos.y;

            // 現在のモデル位置を取得
            let position = furniture.getAttribute('position');

            // XおよびY座標を更新（Z軸はそのまま）
            position.x += deltaX * 0.01;  // 0.01は移動スピードの調整
            position.y -= deltaY * 0.01;

            // 新しい位置を設定
            furniture.setAttribute('position', position);

            // タッチ位置を更新
            initialTouchPos = { x: touch.clientX, y: touch.clientY };
        });

        furniture.addEventListener('touchend', function () {
            isDragging = false;
        });
    </script>

</body>
</html>
